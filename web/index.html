<!-- web/index.html -->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2T DreamMall - Meeting Protocol Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .speaker-0 { color: #3B82F6; } /* Blue */
        .speaker-1 { color: #EF4444; } /* Red */
        .speaker-2 { color: #10B981; } /* Green */
        .speaker-3 { color: #F59E0B; } /* Amber */
        .speaker-4 { color: #8B5CF6; } /* Purple */
        .speaker-5 { color: #EC4899; } /* Pink */
        .speaker-unknown { color: #6B7280; } /* Gray */
        
        .transcript-segment {
            padding: 8px 12px;
            margin: 4px 0;
            border-left: 4px solid;
            background: #F9FAFB;
            border-radius: 0 8px 8px 0;
        }
        
        .timestamp {
            font-size: 0.75rem;
            opacity: 0.7;
            font-family: monospace;
        }
        
        .speaker-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 8px;
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3B82F6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">A2T DreamMall</h1>
                    <p class="text-sm text-gray-600">Audio-zu-Text Meeting Protocol Generator</p>
                </div>
                <div class="text-sm text-gray-500">
                    v1.0.0 | KI-gest√ºtzt
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        
        <!-- Upload Section -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                Audio-Datei hochladen
            </h2>
            
            <!-- Model Selection -->
            <div class="mb-4">
                <label for="modelSelect" class="block text-sm font-medium text-gray-700 mb-2">
                    Whisper Modell w√§hlen
                </label>
                <select id="modelSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="tiny">Tiny (39 MB) - Schnellstes Modell</option>
                    <option value="base" selected>Base (74 MB) - Ausgewogen (Standard)</option>
                    <option value="small">Small (244 MB) - Gute Qualit√§t</option>
                    <option value="medium">Medium (769 MB) - Hohe Qualit√§t</option>
                    <option value="large">Large (1550 MB) - Beste Qualit√§t</option>
                    <option value="large-v2">Large-v2 (1550 MB) - Verbesserte Version</option>
                    <option value="large-v3">Large-v3 (1550 MB) - Neueste Version</option>
                </select>
                <p class="text-sm text-gray-500 mt-1">
                    <span id="modelDescription">Ausgewogen zwischen Geschwindigkeit und Qualit√§t</span>
                </p>
            </div>
            
            <!-- Current Model Display -->
            <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <span class="text-sm font-medium text-blue-800">Aktuelles Modell:</span>
                        <span id="currentModel" class="text-sm text-blue-600 ml-2">Loading...</span>
                    </div>
                    <button id="refreshModels" class="text-blue-600 hover:text-blue-800 text-sm">
                        üîÑ Aktualisieren
                    </button>
                </div>
            </div>
            
            <!-- File Upload -->
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors">
                <input type="file" id="audioFile" accept=".mp3,.wav,.m4a,.mp4,.webm,.ogg" class="hidden">
                <label for="audioFile" class="cursor-pointer">
                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <p class="mt-2 text-sm text-gray-600">
                        <span class="font-medium text-blue-600 hover:text-blue-500">Datei ausw√§hlen</span>
                        oder hier hineinziehen
                    </p>
                    <p class="text-xs text-gray-500 mt-1">
                        Unterst√ºtzte Formate: MP3, WAV, M4A, MP4, WebM, OGG
                    </p>
                </label>
            </div>
            
            <button id="processBtn" 
                    class="w-full mt-4 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed" 
                    disabled>
                Verarbeiten
            </button>
        </div>

        <!-- Status Section -->
        <div id="statusSection" class="hidden bg-white rounded-lg shadow-sm border p-6 mb-8">
            <div class="flex items-center space-x-4">
                <div class="loading-spinner"></div>
                <div>
                    <div id="statusText" class="font-medium text-gray-800"></div>
                    <div id="progressText" class="text-sm text-gray-600"></div>
                </div>
            </div>
            <div class="mt-4">
                <div class="bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            
            <!-- Analysis Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-sm border p-6">
                    <h3 class="text-sm font-medium text-gray-600 mb-2">Dauer</h3>
                    <div id="durationDisplay" class="text-2xl font-bold text-gray-800">--:--</div>
                </div>
                <div class="bg-white rounded-lg shadow-sm border p-6">
                    <h3 class="text-sm font-medium text-gray-600 mb-2">Sprecher</h3>
                    <div id="speakerCount" class="text-2xl font-bold text-gray-800">-</div>
                </div>
                <div class="bg-white rounded-lg shadow-sm border p-6">
                    <h3 class="text-sm font-medium text-gray-600 mb-2">Sprache</h3>
                    <div id="languageDisplay" class="text-2xl font-bold text-gray-800">-</div>
                </div>
            </div>

            <!-- Transcript Section -->
            <div class="bg-white rounded-lg shadow-sm border mb-8">
                <div class="p-6 border-b">
                    <div class="flex items-center justify-between">
                        <h2 class="text-lg font-semibold">Transkript mit Speaker-Erkennung</h2>
                        <div class="flex items-center space-x-4">
                            <div id="speakerLegend" class="flex items-center space-x-3 text-sm"></div>
                            <button onclick="toggleTimestamps()" id="timestampToggle"
                                    class="text-sm text-gray-600 hover:text-gray-800">
                                Zeitstempel anzeigen
                            </button>
                        </div>
                    </div>
                </div>
                <div id="transcriptContent" class="p-6 max-h-96 overflow-y-auto">
                    <!-- Transcript segments will be inserted here -->
                </div>
            </div>

            <!-- Protocol Generation -->
            <div class="bg-white rounded-lg shadow-sm border">
                <div class="p-6 border-b">
                    <div class="flex items-center justify-between">
                        <h2 class="text-lg font-semibold">KI-Meeting-Protokoll</h2>
                        <button onclick="generateProtocol()" id="protocolBtn"
                                class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            ü§ñ Protokoll generieren
                        </button>
                    </div>
                </div>
                <div id="protocolContent" class="p-6">
                    <div class="text-gray-500 text-center py-8">
                        Klicken Sie auf "Protokoll generieren", um ein strukturiertes Meeting-Protokoll zu erstellen.
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
let currentJobId = null;
let pollInterval = null;

// Model descriptions
const modelDescriptions = {
    "tiny": "Schnellstes Modell, geringste Qualit√§t (~32x schneller)",
    "base": "Ausgewogen zwischen Geschwindigkeit und Qualit√§t (~16x schneller)", 
    "small": "Gute Qualit√§t, moderate Geschwindigkeit (~6x schneller)",
    "medium": "Hohe Qualit√§t, langsamer (~2x schneller)",
    "large": "Beste Qualit√§t, langsamste Verarbeitung (1x)",
    "large-v2": "Verbesserte Version von Large (1x)",
    "large-v3": "Neueste Version mit bester Qualit√§t (1x)"
};

// Load available models on page load
async function loadAvailableModels() {
    console.log('üîÑ Loading available models...');
    try {
        console.log('üì° Fetching from /api/v1/models...');
        const response = await fetch('/api/v1/models');
        console.log('üì° Response status:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('üìÑ Models data received:', data);
        
        // Update current model display
        const currentModelSpan = document.getElementById('currentModel');
        if (currentModelSpan) {
            currentModelSpan.textContent = data.current_model || 'base';
            console.log('‚úÖ Current model updated:', data.current_model);
        }
        
        // Update model select options
        const select = document.getElementById('modelSelect');
        if (select && data.available_models) {
            select.innerHTML = '';
            
            Object.entries(data.available_models).forEach(([model, info]) => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = `${model.charAt(0).toUpperCase() + model.slice(1)} (${info.size}) - ${info.description}`;
                if (model === data.current_model) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
            
            console.log(`‚úÖ Model select updated with ${Object.keys(data.available_models).length} options`);
            
            // Update description for initially selected model
            updateModelDescription();
        }
        
    } catch (error) {
        console.error('‚ùå Failed to load models:', error);
        
        // Fallback: Set up basic model options
        const currentModelSpan = document.getElementById('currentModel');
        if (currentModelSpan) {
            currentModelSpan.textContent = 'base (offline)';
        }
        
        const select = document.getElementById('modelSelect');
        if (select) {
            select.innerHTML = `
                <option value="tiny">Tiny (39 MB) - Schnellstes Modell</option>
                <option value="base" selected>Base (74 MB) - Ausgewogen (Standard)</option>
                <option value="small">Small (244 MB) - Gute Qualit√§t</option>
                <option value="medium">Medium (769 MB) - Hohe Qualit√§t</option>
                <option value="large">Large (1550 MB) - Beste Qualit√§t</option>
                <option value="large-v2">Large-v2 (1550 MB) - Verbesserte Version</option>
                <option value="large-v3">Large-v3 (1550 MB) - Neueste Version</option>
            `;
            console.log('‚úÖ Fallback model options set');
        }
    }
}

// Update description when model changes
function updateModelDescription() {
    const select = document.getElementById('modelSelect');
    const descElement = document.getElementById('modelDescription');
    
    if (select && descElement) {
        const selectedModel = select.value;
        const description = modelDescriptions[selectedModel] || 'Keine Beschreibung verf√ºgbar';
        descElement.textContent = description;
    }
}

// File upload handling
function handleFileSelect(event) {
    const files = event.target.files;
    const processBtn = document.getElementById('processBtn');
    
    if (files.length > 0) {
        const file = files[0];
        console.log('File selected:', file.name);
        
        // Enable process button
        if (processBtn) {
            processBtn.disabled = false;
            processBtn.textContent = `${file.name} verarbeiten`;
        }
        
        // Update UI to show file selected
        const label = document.querySelector('label[for="audioFile"]');
        if (label) {
            label.innerHTML = `
                <svg class="mx-auto h-8 w-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <p class="mt-2 text-sm text-green-600">
                    <span class="font-medium">${file.name}</span> ausgew√§hlt
                </p>
                <p class="text-xs text-gray-500 mt-1">
                    Klicken Sie auf "Verarbeiten" um zu starten
                </p>
            `;
        }
    } else {
        // Reset if no file
        if (processBtn) {
            processBtn.disabled = true;
            processBtn.textContent = 'Verarbeiten';
        }
    }
}

// Upload and process audio
async function uploadAudio() {
    console.log('üéØ Upload button clicked!'); // Debug
    
    const fileInput = document.getElementById('audioFile');
    const modelSelect = document.getElementById('modelSelect');
    const processBtn = document.getElementById('processBtn');
    
    console.log('üìã File input:', fileInput);
    console.log('üìã Model select:', modelSelect);
    console.log('üìã Process button:', processBtn);
    
    const file = fileInput ? fileInput.files[0] : null;
    console.log('üìÅ Selected file:', file);
    
    if (!file) {
        alert('Bitte w√§hlen Sie eine Audio-Datei aus.');
        return;
    }
    
    const selectedModel = modelSelect ? modelSelect.value : 'base';
    console.log('üéØ Selected model:', selectedModel);
    
    // Disable button during upload
    if (processBtn) {
        processBtn.disabled = true;
        processBtn.textContent = 'Wird hochgeladen...';
        console.log('üîí Button disabled');
    }
    
    const formData = new FormData();
    formData.append('audio', file);
    formData.append('model', selectedModel);
    
    console.log(`üöÄ Starting upload with model: ${selectedModel}`);
    console.log('üì¶ FormData created:', {
        audioFile: file.name,
        model: selectedModel,
        size: file.size
    });
    
    try {
        console.log('üì° Sending request to /api/v1/transcribe...');
        
        const response = await fetch('/api/v1/transcribe', {
            method: 'POST',
            body: formData
        });
        
        console.log('üì° Response received:', response.status);
        
        const result = await response.json();
        console.log('üìÑ Response data:', result);
        
        if (response.ok) {
            currentJobId = result.job_id;
            console.log('‚úÖ Job started with ID:', currentJobId);
            
            showStatus('processing');
            updateProgress(0);
            
            // Start polling for status
            pollJobStatus();
        } else {
            throw new Error(result.error || 'Upload failed');
        }
    } catch (error) {
        console.error('‚ùå Upload error:', error);
        alert(`Fehler beim Upload: ${error.message}`);
        
        // Re-enable button
        if (processBtn) {
            processBtn.disabled = false;
            processBtn.textContent = file.name + ' verarbeiten';
            console.log('üîì Button re-enabled');
        }
    }
}

// Poll job status
async function pollJobStatus() {
    if (!currentJobId) return;
    
    try {
        const response = await fetch(`/api/v1/status/${currentJobId}`);
        const data = await response.json();
        
        updateProgress(data.progress || 0);
        
        if (data.status === 'completed') {
            if (pollInterval) {
                clearInterval(pollInterval);
                pollInterval = null;
            }
            showResults(data.result);
        } else if (data.status === 'failed') {
            if (pollInterval) {
                clearInterval(pollInterval);
                pollInterval = null;
            }
            showError(data.error || 'Processing failed');
        } else {
            // Continue polling
            if (!pollInterval) {
                pollInterval = setInterval(pollJobStatus, 2000);
            }
        }
    } catch (error) {
        console.error('Polling error:', error);
        if (pollInterval) {
            clearInterval(pollInterval);
            pollInterval = null;
        }
        showError('Connection error');
    }
}

// Show processing status
function showStatus(status) {
    console.log('üìä Showing status:', status);
    
    // Hide upload section
    const uploadSection = document.querySelector('.bg-white.rounded-lg.shadow-sm.border.p-6.mb-8');
    if (uploadSection) {
        uploadSection.style.display = 'none';
        console.log('‚úÖ Upload section hidden');
    }
    
    // Show existing status section or create new one
    let statusSection = document.getElementById('statusSection');
    if (!statusSection) {
        console.log('üîÑ Creating new status section...');
        const main = document.querySelector('main');
        statusSection = document.createElement('div');
        statusSection.id = 'statusSection';
        statusSection.className = 'bg-white rounded-lg shadow-sm border p-6 mb-8';
        statusSection.innerHTML = `
            <div class="text-center">
                <div class="loading-spinner mx-auto mb-4"></div>
                <h3 class="text-lg font-semibold mb-2">Verarbeitung l√§uft...</h3>
                <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                    <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <p id="progressText" class="text-sm text-gray-600">0% abgeschlossen</p>
            </div>
        `;
        main.appendChild(statusSection);
        console.log('‚úÖ Status section created');
    }
    
    // Make sure it's visible
    statusSection.style.display = 'block';
    statusSection.classList.remove('hidden');
    console.log('‚úÖ Status section shown');
}

// Update progress
function updateProgress(progress) {
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    
    if (progressBar) {
        progressBar.style.width = `${progress}%`;
    }
    
    if (progressText) {
        progressText.textContent = `${progress}% abgeschlossen`;
    }
}

// Show results
function showResults(result) {
    console.log('üéâ Showing results:', result);
    
    // Hide status section
    const statusSection = document.getElementById('statusSection');
    if (statusSection) {
        statusSection.style.display = 'none';
        console.log('‚úÖ Status section hidden');
    }
    
    // Create or update results section
    let resultsSection = document.getElementById('resultsSection');
    if (!resultsSection) {
        console.log('üîÑ Creating results section...');
        const main = document.querySelector('main');
        resultsSection = document.createElement('div');
        resultsSection.id = 'resultsSection';
        resultsSection.className = 'bg-white rounded-lg shadow-sm border p-6 mb-8';
        main.appendChild(resultsSection);
    }
    
    // Safeguard against missing data
    const metadata = result.metadata || {};
    const transcript = result.transcript || 'Kein Transkript verf√ºgbar';
    const protocol = result.protocol || result.protocol_text || 'Protokoll-Generierung nicht verf√ºgbar';
    
    resultsSection.innerHTML = `
        <h2 class="text-xl font-semibold mb-4">‚úÖ Verarbeitung abgeschlossen</h2>
        
        <!-- Metadata -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-blue-50 p-4 rounded-lg">
                <h3 class="font-semibold text-blue-800">Dauer</h3>
                <p class="text-blue-600">${metadata.duration_formatted || '0:00'}</p>
            </div>
            <div class="bg-green-50 p-4 rounded-lg">
                <h3 class="font-semibold text-green-800">Sprecher</h3>
                <p class="text-green-600">${metadata.speaker_count || 0}</p>
            </div>
            <div class="bg-purple-50 p-4 rounded-lg">
                <h3 class="font-semibold text-purple-800">Sprache</h3>
                <p class="text-purple-600">${metadata.language?.toUpperCase() || 'DE'}</p>
            </div>
        </div>
        
        <!-- Whisper Model Used -->
        <div class="bg-gray-50 p-3 rounded-lg mb-4">
            <span class="text-sm font-medium text-gray-700">Verwendetes Modell:</span>
            <span class="text-sm text-gray-600 ml-2">${metadata.whisper_model_used || 'unknown'}</span>
        </div>
        
        <!-- Transcript -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3">Transkript mit Speaker-Erkennung</h3>
            <div id="transcriptContent" class="space-y-3 max-h-96 overflow-y-auto border rounded-lg p-4">
                <!-- Will be populated by displayTranscript -->
            </div>
        </div>
        
        <!-- Protocol -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3">KI-Meeting-Protokoll</h3>
            <div class="bg-gray-50 p-4 rounded-lg">
                <pre class="whitespace-pre-wrap text-sm">${protocol}</pre>
            </div>
        </div>
        
        <!-- New Upload Button -->
        <button onclick="resetUpload()" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">
            Neue Datei hochladen
        </button>
    `;
    
    resultsSection.style.display = 'block';
    console.log('‚úÖ Results section displayed');
    
    // Display transcript with speaker information
    try {
        displayTranscript(result);
        console.log('‚úÖ Transcript displayed');
    } catch (error) {
        console.error('‚ùå Error displaying transcript:', error);
    }
}

// Display transcript with speakers
function displayTranscript(data) {
    const transcriptContent = document.getElementById('transcriptContent');
    
    if (!transcriptContent) return;
    
    let segments = [];
    
    // Use segments if available
    if (data.segments && data.segments.length > 0) {
        segments = data.segments;
    } else {
        // Fallback: create single segment
        segments = [{
            speaker: 'Speaker_1',
            text: data.transcript || 'Kein Transkript verf√ºgbar',
            start: 0,
            end: data.metadata?.duration || 0
        }];
    }
    
    // Get unique speakers for color coding
    const speakers = [...new Set(segments.map(s => s.speaker))];
    
    // Create transcript HTML
    transcriptContent.innerHTML = segments.map((segment, index) => {
        const speakerIndex = speakers.indexOf(segment.speaker);
        const speakerColor = getSpeakerColor(speakerIndex);
        
        return `
            <div class="transcript-segment border-l-4 pl-4 py-2" style="border-left-color: ${speakerColor};">
                <div class="flex items-center justify-between mb-1">
                    <span class="speaker-badge px-2 py-1 rounded text-xs font-medium" style="background-color: ${speakerColor}20; color: ${speakerColor};">
                        ${segment.speaker}
                    </span>
                    <span class="timestamp text-xs text-gray-500">
                        ${formatTime(segment.start)} - ${formatTime(segment.end)}
                    </span>
                </div>
                <div class="text-gray-800">${segment.text}</div>
            </div>
        `;
    }).join('');
}

// Get speaker color
function getSpeakerColor(index) {
    const colors = ['#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6', '#EC4899'];
    return colors[index % colors.length] || '#6B7280';
}

// Format time
function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

// Show error
function showError(error) {
    const resultsSection = document.getElementById('resultsSection');
    
    if (resultsSection) {
        resultsSection.innerHTML = `
            <div class="text-center text-red-600">
                <h3 class="text-lg font-semibold mb-2">‚ùå Verarbeitung fehlgeschlagen</h3>
                <p class="mb-4">${error}</p>
                <button onclick="resetUpload()" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                    Erneut versuchen
                </button>
            </div>
        `;
    }
}

// Reset upload
function resetUpload() {
    // Reset global state
    currentJobId = null;
    if (pollInterval) {
        clearInterval(pollInterval);
        pollInterval = null;
    }
    
    // Show upload section, hide results
    const uploadSection = document.querySelector('.bg-white.rounded-lg.shadow-sm.border.p-6.mb-8');
    const resultsSection = document.getElementById('resultsSection');
    
    if (uploadSection) {
        uploadSection.style.display = 'block';
    }
    
    if (resultsSection) {
        resultsSection.remove();
    }
    
    // Reset file input
    const fileInput = document.getElementById('audioFile');
    const processBtn = document.getElementById('processBtn');
    
    if (fileInput) {
        fileInput.value = '';
    }
    
    if (processBtn) {
        processBtn.disabled = true;
        processBtn.textContent = 'Verarbeiten';
    }
    
    // Reset file upload UI
    const label = document.querySelector('label[for="audioFile"]');
    if (label) {
        label.innerHTML = `
            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <p class="mt-2 text-sm text-gray-600">
                <span class="font-medium text-blue-600 hover:text-blue-500">Datei ausw√§hlen</span>
                oder hier hineinziehen
            </p>
            <p class="text-xs text-gray-500 mt-1">
                Unterst√ºtzte Formate: MP3, WAV, M4A, MP4, WebM, OGG
            </p>
        `;
    }
}

// Test function to verify button works
function testButtonClick() {
    console.log('üß™ TEST: Button clicked manually!');
    alert('Button funktioniert!');
}

// Initial load - ERWEITERT mit Debug
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Initializing A2T DreamMall Frontend...');
    
    // Test if DOM elements exist
    const fileInput = document.getElementById('audioFile');
    const processBtn = document.getElementById('processBtn');
    const modelSelect = document.getElementById('modelSelect');
    const refreshBtn = document.getElementById('refreshModels');
    
    console.log('üîç DOM Elements Check:');
    console.log('  - fileInput:', fileInput ? '‚úÖ' : '‚ùå');
    console.log('  - processBtn:', processBtn ? '‚úÖ' : '‚ùå');
    console.log('  - modelSelect:', modelSelect ? '‚úÖ' : '‚ùå');
    console.log('  - refreshBtn:', refreshBtn ? '‚úÖ' : '‚ùå');
    
    // Load models
    loadAvailableModels();
    
    // File input change event
    if (fileInput) {
        fileInput.addEventListener('change', function(e) {
            console.log('üìÅ File input changed:', e.target.files);
            handleFileSelect(e);
        });
        console.log('‚úÖ File input event listener added');
    } else {
        console.error('‚ùå File input not found!');
    }
    
    // Process button click event - ERWEITERT
    if (processBtn) {
        // Remove any existing listeners
        processBtn.removeEventListener('click', uploadAudio);
        
        // Add new listener
        processBtn.addEventListener('click', function(e) {
            console.log('üéØ Process button clicked via event listener!');
            e.preventDefault();
            uploadAudio();
        });
        
        console.log('‚úÖ Process button event listener added');
        
        // Test inline onclick as backup
        processBtn.setAttribute('onclick', 'console.log("üéØ Onclick fired!"); uploadAudio();');
        console.log('‚úÖ Backup onclick attribute added');
    } else {
        console.error('‚ùå Process button not found!');
    }
    
    // Model select change event
    if (modelSelect) {
        modelSelect.addEventListener('change', updateModelDescription);
        console.log('‚úÖ Model select event listener added');
    }
    
    // Refresh models button
    if (refreshBtn) {
        refreshBtn.addEventListener('click', loadAvailableModels);
        console.log('‚úÖ Refresh button event listener added');
    }
    
    console.log('‚úÖ All event listeners initialized');
    
    // Test button after 2 seconds
    setTimeout(() => {
        console.log('üß™ Testing button accessibility...');
        const btn = document.getElementById('processBtn');
        if (btn) {
            console.log('  - Button found:', btn);
            console.log('  - Button disabled:', btn.disabled);
            console.log('  - Button onclick:', btn.onclick);
            console.log('  - Button addEventListener test...');
        }
    }, 2000);
});
    </script>
</body>
</html>